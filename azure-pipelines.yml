trigger:
- main

pool:
  vmImage: ubuntu-latest

variables:
  - name: DOWNLOAD_DIR
    value: $(Build.SourcesDirectory)/download
  - name: CUSTOMER_APP_DIR
    value: $(DOWNLOAD_DIR)
  - name: SMALLWORLD_REGISTRY
    value: $(DOWNLOAD_DIR)/smallworld_registry
  - name: SW_MSF_STARTUP_MAGIK
    value: $(DOWNLOAD_DIR)/scripts/compile_and_build.magik
  - name: AZ_SW_PRODUCT_TO_BUILD
    value: blaak

steps:
  - task: JavaToolInstaller@1
    inputs:
      versionSpec: '17' # string. Required. JDK version. Default: 8.
      jdkArchitectureOption: 'x64' #| 'x86' | 'arm64'. Required. JDK architecture. 
      jdkSourceOption: 'PreInstalled' # 'AzureStorage' | 'LocalDirectory' | 'PreInstalled'

  # download into 
  - task: UniversalPackages@0
    displayName: Download
    inputs:
      command: download
      vstsFeed: 'SW/froggie'                        ## The Artifacts feed hosting the package to be downloaded
      vstsFeedPackage: 'cst.jar'                             ## Name of the package to be downloaded
      vstsPackageVersion: '5.3.0'                       ## Version of the package to be downloaded
      downloadDirectory: '$(DOWNLOAD_DIR)'     ## The download folder. Default value: $(System.DefaultWorkingDirectory).

  - script: |
      sudo java -Daccept_licences="YES" -Dinstall_language_packs="YES" -jar $(DOWNLOAD_DIR)/core_installer.jar $(DOWNLOAD_DIR)/SW vsts vsts
      ls $(Build.SourcesDirectory)
      ls $(DOWNLOAD_DIR)/SW
      ls $(DOWNLOAD_DIR)/SW/core/bin
      ls $(DOWNLOAD_DIR)/SW/core/bin/Linux.x86
    displayName: 'List all content'

  - script: |
      $(DOWNLOAD_DIR)/SW/core/bin/Linux.x86/runalias base
    displayName: 'start compile and build'
  


